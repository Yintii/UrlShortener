<main>
  <div class="container">
    <div class="profile-header">
      <h2>Welcome, <%= @user.email %></h2>
      <p>You have <%= @short_links.count %> shortened links</p>
    </div>

    <% if @short_links.any? %>
            <% @short_links.each do |link| %>
              <div class="short-link-item">
                <div class="short-and-orig-links">
                  <div class="original-link">
                    <a href="<%= link.original_link %>" target="_blank" rel="noopener noreferrer">
                      <%= truncate(link.original_link, length: 50) %>
                    </a>
                  </div>
                  <div class="short-link">
                    <%= link_to short_link_redirect_path(link.short_link) do %>
                      https://yintii.com/<%= link.short_link %>
                    <% end %>     
                  </div>
                </div>
                <%= link_to short_link_analytics_path(link) do %>
                  <button class="short-link-btn" data-link="https://yintii.com/<%= link.short_link %>">
                    <i class="fa-solid fa-chart-line"></i>
                  </button>
                <% end %>
                <button class="short-link-btn copy-to-clipboard" data-link="https://yintii.com/<%= link.short_link %>">
                  <i class="fa-solid fa-copy"></i>
                </button>
              </div>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="empty-state">
        <p>You haven't created any shortened links yet.</p>
        <p><%= link_to "Create one now", root_path, class: "shared-link" %></p>
      </div>
    <% end %>
  </div>

  <script>
    document.querySelectorAll('.copy-to-clipboard').forEach(button => {
      button.addEventListener('click', function() {
        const link = this.getAttribute('data-link');
        navigator.clipboard.writeText(link).then(() => {
          const originalHTML = this.innerHTML;
          this.innerHTML = 'Copied!';
          setTimeout(() => {
            this.innerHTML = originalHTML;
          }, 2000);
        });
      });
    });
  </script>
</main>
